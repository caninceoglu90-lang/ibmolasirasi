<!DOCTYPE html>
<html lang="tr" class="">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mola Sırası</title>
  <!-- Google Fonts: Inter, Montserrat ve blob metni için Dongle -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Montserrat:wght@600&family=Dongle&display=swap"
    rel="stylesheet"
  />
  <style>
    #canvas-stars {
      background: black;
      z-index: 2;
    }
    #canvas-stars, #canvas-shapes {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    #canvas-shapes { z-index: 2; }

    /* Canvas’lar için fade-out animasyonu */
    #canvas-stars.fade-out,
    #canvas-shapes.fade-out {
      transition: opacity 1s ease;
      opacity: 0;
    }

    #toggleHint {
      color: #8f9ebb;
      font-size: 16px;
      position: absolute;
      top: 30px;
      left: 30px;
      z-index: 3;
      user-select: none;
      margin: 0;
    }
    #logoImg { display: none; }

    /* ---------- DEĞİŞKENLER (Light Mode) ---------- */
    :root {
      --primary-color: #002f6c;
      --light-bg: #ffffff;
      --info-bg: #eaf4fc;
      --button-bg: #FE9418;
      --button-hover-bg: #ff7b28;
      --turknet-yellow: #f9a825;
      --font-family: "Inter", Helvetica, Arial, sans-serif;
      --border-radius: 12px;
      --table-header-bg: #eaf4fc;
      --table-row-even: #f9f9f9;
      --text-muted: #555555;

      /* Blob renkleri */
      --color-bg1: rgb(108, 0, 162);
      --color-bg2: rgb(0, 17, 82);
      --color1: 18, 113, 255;
      --color2: 221, 74, 255;
      --color3: 100, 220, 255;
      --color4: 200, 50, 50;
      --color5: 180, 180, 50;
      --color-interactive: 140, 100, 255;
      --circle-size: 80%;
      --blending: hard-light;
    }

    /* ---------- DEĞİŞKENLER (Dark Mode) ---------- */
    html.dark-mode {
      --primary-color: #ffffff;
      --light-bg: #121212;
      --info-bg: #333333;
      --button-bg: #444444;
      --button-hover-bg: #666666;
      --table-header-bg: #2a2a2a;
      --table-row-even: #1e1e1e;
      --text-muted: #cccccc;
    }

    /* ---------- GLOBAL ---------- */
    html, body {
      min-height: 100vh;
      margin: 0;
    }
    body {
      font-family: var(--font-family);
      background-color: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      color: var(--primary-color);
      flex-direction: column;
    }

    /* ---------- GRADIENT BLOBS ARKA PLAN ---------- */
    .gradient-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: linear-gradient(40deg, var(--color-bg1), var(--color-bg2));
      z-index: 0;
    }
    .gradient-bg svg {
      position: fixed;
      top: 0;
      left: 0;
      width: 0;
      height: 0;
    }
    .gradient-bg .gradients-container {
      filter: url(#goo) blur(40px);
      width: 100%;
      height: 100%;
    }
    @keyframes moveInCircle {
      0%   { transform: rotate(0deg); }
      50%  { transform: rotate(180deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes moveVertical {
      0%   { transform: translateY(-50%); }
      50%  { transform: translateY(50%); }
      100% { transform: translateY(-50%); }
    }
    @keyframes moveHorizontal {
      0%   { transform: translateX(-50%) translateY(-10%); }
      50%  { transform: translateX(50%) translateY(10%); }
      100% { transform: translateX(-50%) translateY(-10%); }
    }
    .gradient-bg .g1,
    .gradient-bg .g2,
    .gradient-bg .g3,
    .gradient-bg .g4,
    .gradient-bg .g5,
    .gradient-bg .interactive {
      position: absolute;
      mix-blend-mode: var(--blending);
      background: radial-gradient(
        circle at center,
        rgba(var(--color1), 0.8) 0,
        rgba(var(--color1), 0) 50%
      ) no-repeat;
      width: var(--circle-size);
      height: var(--circle-size);
      top: calc(50% - var(--circle-size) / 2);
      left: calc(50% - var(--circle-size) / 2);
      opacity: 1;
    }
    .gradient-bg .g1 {
      background: radial-gradient(circle at center, rgba(var(--color1), 0.8) 0, rgba(var(--color1), 0) 50%) no-repeat;
      transform-origin: center center;
      animation: moveVertical 30s ease infinite;
    }
    .gradient-bg .g2 {
      background: radial-gradient(circle at center, rgba(var(--color2), 0.8) 0, rgba(var(--color2), 0) 50%) no-repeat;
      transform-origin: calc(50% - 400px);
      animation: moveInCircle 20s reverse infinite;
    }
    .gradient-bg .g3 {
      background: radial-gradient(circle at center, rgba(var(--color3), 0.8) 0, rgba(var(--color3), 0) 50%) no-repeat;
      top: calc(50% - var(--circle-size) / 2 + 200px);
      left: calc(50% - var(--circle-size) / 2 - 500px);
      transform-origin: calc(50% + 400px);
      animation: moveInCircle 40s linear infinite;
    }
    .gradient-bg .g4 {
      background: radial-gradient(circle at center, rgba(var(--color4), 0.8) 0, rgba(var(--color4), 0) 50%) no-repeat;
      transform-origin: calc(50% - 200px);
      animation: moveHorizontal 40s ease infinite;
      opacity: 0.7;
    }
    .gradient-bg .g5 {
      background: radial-gradient(circle at center, rgba(var(--color5), 0.8) 0, rgba(var(--color5), 0) 50%) no-repeat;
      width: calc(var(--circle-size) * 2);
      height: calc(var(--circle-size) * 2);
      top: calc(50% - var(--circle-size));
      left: calc(50% - var(--circle-size));
      transform-origin: calc(50% - 800px) calc(50% + 200px);
      animation: moveInCircle 20s ease infinite;
    }
    .gradient-bg .interactive {
      background: radial-gradient(circle at center, rgba(var(--color-interactive), 0.8) 0, rgba(var(--color-interactive), 0) 50%) no-repeat;
      width: 100%;
      height: 100%;
      top: -50%;
      left: -50%;
      opacity: 0.7;
    }

    /* ---------- CARD STİLLERİ ---------- */
    .card {
      margin-bottom: 0 !important;
      border-radius: 12px 12px 0 0;
    }
    .card2 {
      margin-top: 0 !important;
      border-radius: 0 0 12px 12px;
      padding-top: 0 !important;
    }
    .card, .card2 {
      background-color: var(--light-bg);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      width: 380px;
      max-width: 90%;
      padding: 24px;
      box-sizing: border-box;
      position: relative;
      z-index: 1;
      margin: 2rem auto;
      color: var(--primary-color);
    }
    .logo {
      display: flex;
      align-items: center;
      justify-content: left;
      margin-bottom: 24px;
    }
    .logo img {
      height: 45px;
      width: auto;
      margin-right: 8px;
    }
    .logo-text {
      font-family: 'Montserrat', sans-serif;
      font-size: 1.6rem;
      font-weight: 600;
      color: var(--primary-color);
      line-height: 1.6rem;
    }
    .title {
      font-size: 2.4rem;
      font-weight: 600;
      color: rgb(78, 0, 82);
      text-align: left;
      margin-bottom: 12px;
      font-family: 'Montserrat';
    }
    .card2 .title {
      margin-top: 0 !important;
    }
    .info-box {
      background: linear-gradient(90deg, rgb(255, 239, 254) 0%, rgb(255, 248, 255) 100%);
      border-radius: 8px;
      padding: 12px 16px;
      margin: 0 auto 20px auto;
      font-size: 0.95rem;
      text-align: center;
      color: rgb(78, 0, 82);
      max-width: 100%;
    }
    .info-box strong {
      font-weight: 500;
    }
    .btn-primary {
      display: block;
      width: 100%;
      background-color: rgb(78, 0, 82);
      color: #ffffff;
      text-decoration: none;
      font-size: 1rem;
      font-weight: 500;
      padding: 12px 0;
      border-radius: 8px;
      text-align: center;
      transition: background-color 0.2s ease;
      margin-bottom: 24px;
      border: none;
      cursor: pointer;
    }
    .btn-primary:hover {
      background: linear-gradient(90deg, rgb(255, 239, 254) 0%, rgb(255, 248, 255) 100%);
      color: rgb(78, 0, 82);
      border: 1px solid rgb(153, 108, 156);
    }
    .table-wrapper {
      position: relative;
      overflow-x: auto;
      margin-bottom: 24px;
    }
    .loader {
      position: absolute;
      top: -32px;
      left: calc(50% - 32px);
      width: 64px;
      height: 64px;
      border-radius: 50%;
      perspective: 800px;
      display: none;
      z-index: 10;
    }
    .inner {
      position: absolute;
      box-sizing: border-box;
      width: 100%;
      height: 100%;
      border-radius: 50%;
    }
    .inner.one {
      left: 0;
      top: 0;
      border-bottom: rgb(78, 0, 82);
      animation: rotate-one 1s linear infinite;
    }
    .inner.two {
      right: 0;
      top: 0;
      border-right: rgb(78, 0, 82);
      animation: rotate-two 1s linear infinite;
    }
    .inner.three {
      right: 0;
      bottom: 0;
      border-top: rgb(78, 0, 82);
      animation: rotate-three 1s linear infinite;
    }
    @keyframes rotate-one {
      from { transform: rotateX(35deg) rotateY(-45deg) rotateZ(0deg); }
      to   { transform: rotateX(35deg) rotateY(-45deg) rotateZ(360deg); }
    }
    @keyframes rotate-two {
      from { transform: rotateX(50deg) rotateY(10deg) rotateZ(0deg); }
      to   { transform: rotateX(50deg) rotateY(10deg) rotateZ(360deg); }
    }
    @keyframes rotate-three {
      from { transform: rotateX(35deg) rotateY(55deg) rotateZ(0deg); }
      to   { transform: rotateX(35deg) rotateY(55deg) rotateZ(360deg); }
    }
    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 8px;
      overflow: hidden;
      font-size: 0.95rem;
      background-color: var(--light-bg);
      color: rgb(78, 0, 82);
    }
    thead {
      background: linear-gradient(90deg, rgb(255, 239, 254) 0%, rgb(255, 248, 255) 100%);
    }
    th, td {
      padding: 12px 8px;
      text-align: left;
    }
    th {
      font-weight: 500;
      color: rgb(78, 0, 82);
    }
    tbody tr:nth-child(even) {
      background-color: var(--table-row-even);
    }
    .placeholder {
      text-align: center;
      color: var(--text-muted);
      font-style: italic;
      padding: 12px 0;
    }
    .card-footer {
      text-align: center;
      margin-top: 16px;
      line-height: 1.3;
      color: rgb(78, 0, 82);
    }
    .card-footer .version {
      opacity: 0.6;
      font-size: 0.85rem;
      margin-bottom: 4px;
    }
    .card-footer .copyright {
      font-size: 0.67rem;
      opacity: 0.9;
    }

    /* ---------- MOLA SAYAÇ STİLLERİ ---------- */
    .timer-cell {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .btn-timer-start {
      background-color: rgb(78, 0, 82);
      color: #ffffff;
      border: none;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
      white-space: nowrap;
    }
    .btn-timer-start:hover:not(:disabled) {
      background: linear-gradient(90deg, rgb(255, 239, 254) 0%, rgb(255, 248, 255) 100%);
      color: rgb(78, 0, 82);
      border: 1px solid rgb(153, 108, 156);
      transform: translateY(-1px);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
    }
    .btn-timer-start:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .base-timer {
      position: relative;
      width: 64px;
      height: 64px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .base-timer__svg {
      transform: scaleX(-1);
    }
    .base-timer__circle {
      fill: none;
      stroke: none;
    }
    .base-timer__path-elapsed {
      stroke-width: 7px;
      stroke: rgba(71, 30, 80, 0.2);
    }
    .base-timer__path-remaining {
      stroke-width: 7px;
      stroke-linecap: round;
      transform: rotate(90deg);
      transform-origin: center;
      transition: 1s linear all;
      fill-rule: nonzero;
      stroke: currentColor;
    }
    .base-timer__path-remaining.green {
      color: rgb(65, 184, 131);
    }
    .base-timer__path-remaining.orange {
      color: #ff9800;
    }
    .base-timer__path-remaining.red {
      color: #f44336;
    }
    .base-timer__label {
      position: absolute;
      width: 64px;
      height: 64px;
      top: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: 600;
      color: rgb(78, 0, 82);
    }

    /* ---------- FORM MODAL (Mini Pencere) ---------- */
    .form-modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 5;
    }
    .form-modal--hidden {
      display: none;
    }
    .form-modal__backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
    }
    .form-modal__content {
      position: relative;
      z-index: 1;
      background-color: var(--light-bg);
      border-radius: 16px;
      width: min(480px, 95vw);
      height: min(620px, 80vh);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.35);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .form-modal__header {
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(71, 30, 80, 0.12);
      font-family: 'Montserrat', sans-serif;
      font-size: 0.95rem;
      color: rgb(78, 0, 82);
    }
    .form-modal__close {
      border: none;
      background: transparent;
      color: rgb(78, 0, 82);
      font-size: 1rem;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 999px;
      transition: background 0.15s ease;
    }
    .form-modal__close:hover {
      background: rgba(71, 30, 80, 0.08);
    }
    .form-modal__body {
      flex: 1;
      padding: 0;
    }
    .form-modal__body iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: #fff;
    }
  </style>
</head>
<body>
  <!-- ⭐ Yıldız Arka Planı -->
  <canvas id="canvas-stars"></canvas>
  <!-- ⚪ Nokta Partikülleri -->
  <canvas id="canvas-shapes"></canvas>

  <!-- Gizli Logo Görseli -->
  <img id="logoImg" src="https://ik.imagekit.io/labi7oyze/logo_image.png?updatedAt=1762089509729" crossOrigin="anonymous" alt="Logo" />

  <!-- ---------- GRADIENT BLOBS ARKA PLAN ---------- -->
  <div class="gradient-bg">
    <svg xmlns="http://www.w3.org/2000/svg">
      <defs>
        <filter id="goo">
          <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
          <feColorMatrix in="blur" mode="matrix"
            values="1 0 0 0 0  
                    0 1 0 0 0  
                    0 0 1 0 0  
                    0 0 0 18 -8"
            result="goo" />
          <feBlend in="SourceGraphic" in2="goo" />
        </filter>
      </defs>
    </svg>
    <div class="gradients-container">
      <div class="g1"></div>
      <div class="g2"></div>
      <div class="g3"></div>
      <div class="g4"></div>
      <div class="g5"></div>
      <div class="interactive"></div>
    </div>
  </div>

  <!-- ---------- MOLA SIRASI CARD ---------- -->
  <div class="card">
    <div class="logo">
      <svg width="112" height="32" viewBox="0 0 112 32" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M26.8819 23.7083C24.6963 23.7083 23.3762 22.1348 23.3762 19.5121V10.1929H19.4073V19.7394C19.4073 24.5476 22.1873 27.3713 26.8819 27.3713C31.5765 27.3713 34.3304 24.5214 34.3304 19.7394V10.1929H30.3613V19.5121C30.3613 22.1348 29.0413 23.7083 26.8732 23.7083H26.8819ZM62.6642 10.1929H58.4679C58.1707 13.1565 55.5304 15.4382 51.8849 16.3911V4.63281H47.916V27.0129H51.8849V22.1348C51.8849 21.2955 52.4357 20.4912 53.205 20.1503L58.739 27.0129H63.3898L56.5534 18.4892C59.5607 16.6446 62.0261 13.751 62.6642 10.1929ZM36.0264 27.0129H39.9954V19.2848C39.9954 14.8874 42.3908 13.2876 46.3511 14.022V9.87815C44.2354 9.7645 42.452 9.90437 40.6074 10.7873C36.551 12.7019 36.0264 16.3736 36.0264 20.3338V27.0129ZM80.1664 18.7603C80.1664 23.7958 83.8119 27.3713 88.9174 27.3713C92.3619 27.3713 95.1856 25.754 96.6892 22.8778L93.2273 21.3042C92.1083 23.0789 90.8144 23.8832 89.0572 23.8832C86.5744 23.8832 84.6162 22.3358 84.3889 20.1678C85.7527 20.4825 87.2564 20.666 88.7863 20.666C91.3128 20.666 94.0753 20.1677 97.1264 19.1624C97.1701 18.6816 97.1701 18.498 97.1701 18.227C97.1701 13.375 93.6382 9.81695 88.8562 9.81695C84.0741 9.81695 80.1751 13.6198 80.1751 18.7515H80.1664V18.7603ZM84.3539 16.8894C84.6948 14.8612 86.6968 13.2439 88.8649 13.2439C91.033 13.2439 92.7203 14.7738 93.0088 16.8894C91.6887 17.2566 90.2987 17.4402 88.7688 17.4402C87.2389 17.4402 85.7876 17.2566 84.3451 16.8894H84.3539ZM71.3716 13.4974C73.5396 13.4974 74.8597 15.071 74.8597 17.6937V27.0129H78.8288V17.4664C78.8288 12.6844 76.0487 9.83443 71.3803 9.83443C66.7119 9.83443 63.9056 12.6582 63.9056 17.4664V27.0129H67.8746V17.6937C67.8746 15.071 69.1947 13.4974 71.3803 13.4974H71.3716ZM14.599 20.0366C14.599 21.8812 14.1444 23.7083 12.0025 23.7083C8.85526 23.7083 8.96894 19.853 8.96894 17.6238V13.8821H5V17.6238C5 22.4058 5.93535 27.3801 11.8102 27.3801C16.3474 27.3801 18.4194 24.4165 18.4194 20.0453H14.5903H14.599V20.0366ZM5.00864 4.63281V10.1929C5.00864 12.2211 6.53858 13.8821 8.42692 13.8821H14.9924V10.1929H8.97769V4.63281H5.00864ZM108.011 20.0366C108.011 21.8812 107.556 23.7083 105.414 23.7083C102.267 23.7083 102.38 19.853 102.38 17.6238V13.8821H98.4116V17.6238C98.4116 22.4058 99.3469 27.3801 105.222 27.3801C109.759 27.3801 111.831 24.4165 111.831 20.0453H108.002L108.011 20.0366ZM98.4203 4.63281V10.1929C98.4203 12.2211 99.9501 13.8821 101.838 13.8821H108.404V10.1929H102.389V4.63281H98.4203Z" fill="#471E50"/>
      </svg>
    </div>

    <h1 class="title">Mola Sırası</h1>

    <div class="info-box">
      Sıra bilgisi her <strong>5 saniyede</strong> güncellenir.
    </div>
    <div class="info-box">
      <p class="degisken"></p>
    </div>

    <!-- Aynı sekme içinde modal açan buton -->
    <button type="button" class="btn-primary" id="openFormBtn">
      Sıraya Katıl
    </button>

    <div class="table-wrapper">
      <div class="loader" id="loaderQueue">
        <div class="inner one"></div>
        <div class="inner two"></div>
        <div class="inner three"></div>
      </div>

      <table id="molaTableQueue">
        <thead>
          <tr>
            <th>#</th>
            <th>Zaman Damgası</th>
            <th>Ad Soyad</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td colspan="3" class="placeholder">Veri yüklenemedi.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Google Form Mini Penceresi (Modal) -->
  <div id="formModal" class="form-modal form-modal--hidden">
    <div class="form-modal__backdrop"></div>
    <div class="form-modal__content">
      <div class="form-modal__header">
        <span>Mola Sırası Formu</span>
        <button type="button" class="form-modal__close" id="closeFormBtn">✕</button>
      </div>
      <div class="form-modal__body">
        <iframe
          src="https://forms.gle/bMmRf2wX3MPEyu3K7"
          frameborder="0"
          allowfullscreen
        ></iframe>
      </div>
    </div>
  </div>

  <!-- ---------- SAYAÇ CARD ---------- -->
  <div class="card2">
    <h1 class="title">Mola Sayacı</h1>

    <div class="info-box">
      Mola sırasında adı listeden silinen her kişi için, karşısındaki mor butona basıldığında
      <strong>15 dakikalık sayaç</strong> başlar; süre bitince bildirim gelir.
    </div>

    <div class="table-wrapper">
      <div class="loader" id="loaderTimer">
        <div class="inner one"></div>
        <div class="inner two"></div>
        <div class="inner three"></div>
      </div>

      <table id="timerTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Zaman Damgası</th>
            <th>Ad Soyad</th>
            <th>Sayaç</th>
          </tr>
        </thead>
        <tbody>
          <tr class="placeholder-row">
            <td colspan="4" class="placeholder">Henüz sayaç başlatılmadı.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="card-footer">
      <div class="version">v3</div>
      <div class="copyright">
        © 2025 Geliştiriciler: Erhan Demirci , Ahmet Can İnceoğlu , Umut Ablay
      </div>
    </div>
  </div>

  <!-- ---------- JavaScript ---------- -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenLite.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/easing/EasePack.min.js"></script>
  <script>
  /* === 1) Yıldız Arka Planı === */
  (function() {
    const canvas = document.getElementById('canvas-stars');
    const ctx = canvas.getContext('2d');
    const dotRadius = 2;
    const colors = ['#4e0052'];

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    function drawStar(ctx, cx, cy, spikes, outerRadius, innerRadius, fillStyle, alpha) {
      let rot = Math.PI / 2 * 3;
      let x = cx;
      let y = cy;
      let step = Math.PI / spikes;
      ctx.save();
      ctx.beginPath();
      ctx.moveTo(cx, cy - outerRadius);
      for (let i = 0; i < spikes; i++) {
        x = cx + Math.cos(rot) * outerRadius;
        y = cy + Math.sin(rot) * outerRadius;
        ctx.lineTo(x, y);
        rot += step;
        x = cx + Math.cos(rot) * innerRadius;
        y = cy + Math.sin(rot) * innerRadius;
        ctx.lineTo(x, y);
        rot += step;
      }
      ctx.closePath();
      ctx.globalAlpha = alpha;
      ctx.fillStyle = fillStyle;
      ctx.fill();
      ctx.restore();
    }

    class Star {
      constructor() { this.reset(); }
      reset() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.r = dotRadius;
        this.a = Math.random() * 0.5 + 0.3;
        this.da = (Math.random() * 0.005 + 0.002) * (Math.random() < 0.5 ? 1 : -1);
        this.color = colors[Math.floor(Math.random() * colors.length)];
      }
      update() {
        this.a += this.da;
        if (this.a <= 0.1 || this.a >= 1) this.da *= -1;
      }
      draw() {
        drawStar(ctx, this.x, this.y, 5, this.r * 2, this.r, this.color, this.a);
      }
    }

    let stars = [];
    function initStars() {
      stars = [];
      const count = Math.floor((window.innerWidth + window.innerHeight) / 8);
      for (let i = 0; i < count; i++) stars.push(new Star());
    }
    initStars();
    window.addEventListener('resize', initStars);

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      stars.forEach(s => { s.update(); s.draw(); });
      requestAnimationFrame(animate);
    }
    animate();
  })();

  /* === 2) Partiküllerden Logoya Birleşme === */
  (function() {
    const stage = document.getElementById('canvas-shapes');
    const ctx2 = stage.getContext('2d');
    const img = document.getElementById('logoImg');
    const imageW = 600, imageH = 126;
    const dotRadius = 1.5;
    let w, h;

    const offCanvas = document.createElement('canvas');
    const offCtx = offCanvas.getContext('2d');
    offCanvas.width = imageW;
    offCanvas.height = imageH;

    const dots = [];

    function resize() {
      w = stage.width = window.innerWidth;
      h = stage.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    function drawStar(ctx, cx, cy, spikes, outerR, innerR, fillStyle, alpha) {
      let rot = Math.PI / 2 * 3;
      const step = Math.PI / spikes;
      ctx.save();
      ctx.beginPath();
      ctx.moveTo(cx, cy - outerR);
      for (let i = 0; i < spikes; i++) {
        ctx.lineTo(
          cx + Math.cos(rot) * outerR,
          cy + Math.sin(rot) * outerR
        );
        rot += step;
        ctx.lineTo(
          cx + Math.cos(rot) * innerR,
          cy + Math.sin(rot) * innerR
        );
        rot += step;
      }
      ctx.closePath();
      ctx.globalAlpha = alpha;
      ctx.fillStyle = fillStyle;
      ctx.fill();
      ctx.restore();
    }

    function Dot(x, y, r, g, b, imgX, imgY) {
      this.x = x; this.y = y;
      this.r = r; this.g = g; this.b = b;
      this.targetX = imgX + (w - imageW) / 2;
      this.targetY = imgY + (h - imageH) / 2;
    }
    Dot.prototype.draw = function() {
      drawStar(
        ctx2,
        this.x, this.y,
        5,
        dotRadius * 2,
        dotRadius,
        `rgb(${this.r},${this.g},${this.b})`,
        1
      );
    };

    function loop() {
      ctx2.clearRect(0, 0, w, h);
      dots.forEach(d => d.draw());
      requestAnimationFrame(loop);
    }
    loop();

    function processImage() {
      offCtx.clearRect(0, 0, imageW, imageH);
      offCtx.drawImage(img, 0, 0, imageW, imageH);
      const data = offCtx.getImageData(0, 0, imageW, imageH).data;
      const pixels = [];
      for (let i = 0; i < data.length; i += 4) {
        if (data[i+3] !== 0) {
          const idx = i / 4;
          const x = idx % imageW, y = Math.floor(idx / imageW);
          if (x % (dotRadius * 2 + 1) === 0 && y % (dotRadius * 2 + 1) === 0) {
            pixels.push({ x, y, r: data[i], g: data[i+1], b: data[i+2] });
          }
        }
      }
      createDots(pixels);
    }

    function createDots(pixels) {
      pixels.forEach(p => {
        const startX = Math.random() * w;
        const startY = Math.random() * h;
        const dot = new Dot(startX, startY, p.r, p.g, p.b, p.x, p.y);
        dots.push(dot);
        const dur = 2 + Math.random() * 1;
        const delay = 0.5 + Math.random() * 0.5;
        TweenLite.to(dot, dur, {
          x: dot.targetX,
          y: dot.targetY,
          ease: Cubic.easeInOut,
          delay: delay
        });
      });
    }

    if (img.complete) processImage();
    else img.onload = processImage;
  })();

  // İsteğe bağlı: isim
  const YOUR_NAME = "AD SOYADINIZ"; // Buraya istersen adını yazabilirsin

  // Google Sheets sabitleri
  const SHEET_ID = "1e76vIg2R_du1QcIabDJK7eqxEOV8lic3z3r9Vi9-dRQ";
  const SHEET_NAME_QUEUE = "Form Responses 1";
  const BASE_URL_QUEUE =
    `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME_QUEUE)}&tqx=out:json`;

  const SHEET_NAME_WARNING = "Uyarı/Bilgilendirme Mesajı";
  const BASE_URL_WARNING =
    `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME_WARNING)}&tqx=out:json`;

  // Önceki isim listesi (mola sırası sheet'i için)
  let previousNames = [];

  // Sayaç sistemi sabitleri
  const BREAK_SECONDS = 15 * 60; // 15 dakika
  const FULL_DASH_ARRAY = 283;
  const WARNING_THRESHOLD = 5 * 60;
  const ALERT_THRESHOLD = 60;

  const COLOR_CODES = {
    info: {
      color: "green"
    },
    warning: {
      color: "orange",
      threshold: WARNING_THRESHOLD
    },
    alert: {
      color: "red",
      threshold: ALERT_THRESHOLD
    }
  };

  // Her sekmede çalışan runtime timer map'i
  let timers = {};

  // Timerları kalıcı saklamak için localStorage key'i
  const TIMER_STORAGE_KEY = "molaTimers_v1";
  let timerStateCache = null;

  function formatTime(totalSeconds) {
    const minutes = Math.floor(totalSeconds / 60);
    let seconds = totalSeconds % 60;
    if (seconds < 10) seconds = `0${seconds}`;
    return `${minutes}:${seconds}`;
  }

  function calculateTimeFraction(timer) {
    const rawTimeFraction = timer.timeLeft / timer.timeLimit;
    return rawTimeFraction - (1 / timer.timeLimit) * (1 - rawTimeFraction);
  }

  function setCircleDasharray(timer) {
    const circleDasharray = `${Math.round(
      calculateTimeFraction(timer) * FULL_DASH_ARRAY
    )} ${FULL_DASH_ARRAY}`;
    if (timer.pathEl) {
      timer.pathEl.setAttribute("stroke-dasharray", circleDasharray);
    }
  }

  function setRemainingPathColor(timer) {
    const { alert, warning, info } = COLOR_CODES;
    const path = timer.pathEl;
    if (!path) return;

    path.classList.remove(info.color, warning.color, alert.color);

    if (timer.timeLeft <= alert.threshold) {
      path.classList.add(alert.color);
    } else if (timer.timeLeft <= warning.threshold) {
      path.classList.add(warning.color);
    } else {
      path.classList.add(info.color);
    }
  }

  function updateTimerUi(timer) {
    if (timer.labelEl) {
      timer.labelEl.textContent = formatTime(Math.max(0, timer.timeLeft));
    }
    setRemainingPathColor(timer);
    setCircleDasharray(timer);
  }

  // localStorage'dan timer state'ini oku
  function getTimerStateList() {
    if (timerStateCache !== null) return timerStateCache;
    let list = [];
    try {
      if (window.localStorage) {
        const raw = localStorage.getItem(TIMER_STORAGE_KEY);
        if (raw) {
          const parsed = JSON.parse(raw);
          if (Array.isArray(parsed)) list = parsed;
        }
      }
    } catch (e) {
      console.warn("localStorage okunamadı:", e);
    }
    timerStateCache = list;
    return list;
  }

  // localStorage'a timer state'ini yaz
  function setTimerStateList(list) {
    timerStateCache = list;
    try {
      if (window.localStorage) {
        localStorage.setItem(TIMER_STORAGE_KEY, JSON.stringify(list));
      }
    } catch (e) {
      console.warn("localStorage yazılamadı:", e);
    }
  }

  // localStorage değiştiğinde tüm sekmeleri güncel tut
  window.addEventListener("storage", function (event) {
    if (event.key === TIMER_STORAGE_KEY) {
      try {
        timerStateCache = event.newValue ? JSON.parse(event.newValue) : [];
      } catch (e) {
        timerStateCache = [];
      }
      syncTimersFromState(timerStateCache);
    }
  });

  // State -> tablo & JS timer objelerine senkronizasyon
  function syncTimersFromState(passedList) {
    const stateListRaw = passedList || getTimerStateList();
    const now = Date.now();
    const activeStates = stateListRaw.filter(s => !s.endAt || s.endAt > now);

    const tbody = document.querySelector("#timerTable tbody");
    if (!tbody) return;

    // Var olan interval'ları temizle
    Object.values(timers).forEach(t => {
      if (t.intervalId) clearInterval(t.intervalId);
    });
    timers = {};

    tbody.innerHTML = "";

    if (activeStates.length === 0) {
      const placeholderRow = document.createElement("tr");
      placeholderRow.className = "placeholder-row";
      placeholderRow.innerHTML = `<td colspan="4" class="placeholder">Henüz sayaç başlatılmadı.</td>`;
      tbody.appendChild(placeholderRow);
      return;
    }

    activeStates.forEach((state, idx) => {
      const { tr, timer } = createTimerRow(state, idx + 1);
      tbody.appendChild(tr);
      timers[state.id] = timer;

      // Sayaç daha önce başlatılmışsa, herkeste kaldığı yerden devam
      if (state.startedAt && state.endAt && state.endAt > now) {
        runTimerInterval(timer);
      }
    });
  }

  // Tek bir state objesinden tablo satırı ve JS timer nesnesi oluştur
  function createTimerRow(state, rowIndex) {
    const timerId = state.id;
    const pathId = "base-timer-path-" + timerId;
    const labelId = "base-timer-label-" + timerId;
    const createdTime = state.createdAt ? new Date(state.createdAt) : new Date();
    const now = Date.now();

    let timeLeft;
    if (state.startedAt && state.endAt) {
      timeLeft = Math.max(0, Math.round((state.endAt - now) / 1000));
    } else {
      timeLeft = BREAK_SECONDS;
    }

    const tr = document.createElement("tr");
    tr.dataset.timerId = timerId;
    tr.dataset.name = state.name;

    tr.innerHTML = `
      <td>${rowIndex}</td>
      <td>${createdTime.toLocaleString("tr-TR")}</td>
      <td>${state.name}</td>
      <td>
        <div class="timer-cell">
          <button type="button" class="btn-timer-start">Başlat</button>
          <div class="base-timer" style="display:none;">
            <svg class="base-timer__svg" viewBox="0 0 100 100">
              <g class="base-timer__circle">
                <circle class="base-timer__path-elapsed" cx="50" cy="50" r="45"></circle>
                <path
                  id="${pathId}"
                  stroke-dasharray="${FULL_DASH_ARRAY}"
                  class="base-timer__path-remaining green"
                  d="
                    M 50, 50
                    m -45, 0
                    a 45,45 0 1,0 90,0
                    a 45,45 0 1,0 -90,0
                  "
                ></path>
              </g>
            </svg>
            <span id="${labelId}" class="base-timer__label">${formatTime(timeLeft)}</span>
          </div>
        </div>
      </td>
    `;

    const startButton = tr.querySelector(".btn-timer-start");
    const baseTimerEl = tr.querySelector(".base-timer");
    const labelEl = tr.querySelector(`#${labelId}`);
    const pathEl = tr.querySelector(`#${pathId}`);

    const timer = {
      id: timerId,
      name: state.name,
      timeLimit: BREAK_SECONDS,
      timeLeft: timeLeft,
      intervalId: null,
      labelEl,
      pathEl,
      baseTimerEl,
      startButton
    };

    if (state.startedAt && state.endAt && state.endAt > now && timeLeft > 0) {
      // Sayaç daha önce başlatılmış, herkes için çalışıyor
      baseTimerEl.style.display = "inline-flex";
      if (startButton) startButton.style.display = "none";
    } else {
      // Henüz başlatılmamış
      baseTimerEl.style.display = "none";
      if (startButton) startButton.style.display = "inline-block";
    }

    updateTimerUi(timer);

    if (startButton) {
      startButton.addEventListener("click", () => {
        startTimer(timerId);
      });
    }

    return { tr, timer };
  }

  // Başlat butonuna tıklandığında çalışır
  function startTimer(timerId) {
    const timer = timers[timerId];
    if (!timer || timer.intervalId) return;

    const list = getTimerStateList();
    const idx = list.findIndex(s => s.id === timerId);
    if (idx === -1) return;

    const now = Date.now();
    list[idx].startedAt = now;
    list[idx].endAt = now + timer.timeLimit * 1000;
    setTimerStateList(list); // diğer sekmelere de gider

    timer.timeLeft = timer.timeLimit;
    if (timer.baseTimerEl) timer.baseTimerEl.style.display = "inline-flex";
    if (timer.startButton) timer.startButton.style.display = "none";

    updateTimerUi(timer);
    runTimerInterval(timer);
  }

  // Her 1 saniyede bir kalan süreyi state'e göre günceller
  function runTimerInterval(timer) {
    if (timer.intervalId) clearInterval(timer.intervalId);

    timer.intervalId = setInterval(() => {
      const list = getTimerStateList();
      const state = list.find(s => s.id === timer.id);
      if (!state || !state.endAt) {
        clearInterval(timer.intervalId);
        timer.intervalId = null;
        return;
      }

      const now = Date.now();
      const timeLeft = Math.max(0, Math.round((state.endAt - now) / 1000));
      timer.timeLeft = timeLeft;
      updateTimerUi(timer);

      if (timeLeft <= 0) {
        clearInterval(timer.intervalId);
        timer.intervalId = null;
        handleTimerFinished(timer);
      }
    }, 1000);
  }

  // Sayaç bittiğinde: bildirim gönder, state'ten sil, tabloyu yenile
  function handleTimerFinished(timer) {
    const list = getTimerStateList();
    const idx = list.findIndex(s => s.id === timer.id);
    if (idx === -1) {
      return; // başka sekme zaten silmiş olabilir
    }
    list.splice(idx, 1);
    setTimerStateList(list);

    sendNotification(timer.name + " için 15 dakikalık mola süresi doldu.");

    // Tüm sekmelerde tabloyu güncelle
    syncTimersFromState(list);
  }

  // Yeni bir isim sayaç listesine eklendiğinde (queue'dan düşerken) çağrılır
  function addTimerEntry(name) {
    const trimmedName = (name || "").toString().trim();
    if (!trimmedName) return;

    const list = getTimerStateList();
    const now = Date.now();

    // Aynı isim için zaten aktif sayaç varsa bir daha ekleme
    const already = list.some(
      s =>
        s.name === trimmedName &&
        (!s.endAt || s.endAt > now)
    );
    if (already) return;

    const timerId = "t-" + Date.now() + "-" + Math.floor(Math.random() * 10000);
    const newState = {
      id: timerId,
      name: trimmedName,
      createdAt: now,
      startedAt: null,
      endAt: null
    };
    list.push(newState);
    setTimerStateList(list);
    syncTimersFromState(list);
  }

  // Console’dan test için:
  window.addTimerEntry = addTimerEntry;
  window.startTimer = startTimer;

  // Mola sırası listesini yenileyen fonksiyon
  async function refreshQueue() {
    const loader = document.getElementById("loaderQueue");
    const tbody = document.querySelector("#molaTableQueue tbody");

    if (loader) loader.style.display = "block";

    try {
      const res = await fetch(`${BASE_URL_QUEUE}&cacheBuster=${Date.now()}`, {
        cache: "no-store",
      });
      const txt = await res.text();
      const json = JSON.parse(
        txt.slice(txt.indexOf("{"), txt.lastIndexOf("}") + 1)
      );
      const rows = json.table.rows || [];

      const dataRows = rows.filter((r) => {
        const t = r.c?.[0]?.v;
        const n = r.c?.[1]?.v;
        return (
          t &&
          n &&
          n.toString().toLowerCase() !== "ad soyad" &&
          t.toString().toLowerCase() !== "zaman damgası"
        );
      });

      const currentNames = dataRows.map((r) => r.c[1].v);

      // Sıradan çıkan isimler → yeni sayaç entry
      const leavingNames = previousNames.filter(
        (name) => !currentNames.includes(name)
      );

      leavingNames.forEach((isim) => {
        sendNotification(isim + ", mola sırası sende!");
        addTimerEntry(isim);
      });

      tbody.innerHTML = "";
      if (dataRows.length > 0) {
        dataRows.forEach((r, i) => {
          const ts = r.c[0].f || r.c[0].v || "-";
          const name = r.c[1].v || "-";
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${i + 1}</td><td>${ts}</td><td>${name}</td>`;
          tbody.appendChild(tr);
        });
      } else {
        tbody.innerHTML = `<tr><td colspan="3" class="placeholder">Listede kimse yok.</td></tr>`;
      }

      previousNames = currentNames.slice();
    } catch (e) {
      console.error("Veri yüklenirken hata (Queue):", e);
      if (tbody) {
        tbody.innerHTML = `<tr><td colspan="3" class="placeholder">Veri yüklenemedi.</td></tr>`;
      }
    } finally {
      if (loader) loader.style.display = "none";
    }
  }

  // Uyarı metnini çeken fonksiyon
  async function refreshWarning() {
    try {
      const res = await fetch(`${BASE_URL_WARNING}&cacheBuster=${Date.now()}`, {
        cache: "no-store",
      });
      const txt = await res.text();
      const json = JSON.parse(
        txt.slice(txt.indexOf("{"), txt.lastIndexOf("}") + 1)
      );
      const rows = json.table.rows || [];

      if (rows.length > 0 && rows[0].c?.[1]?.v) {
        const warningText = rows[0].c[1].v;
        document.querySelector(".degisken").innerText = warningText;
      } else {
        document.querySelector(".degisken").innerText = "";
      }
    } catch (e) {
      console.error("Uyarı metni alınırken hata:", e);
      document.querySelector(".degisken").innerText = "";
    }
  }

  // Bildirim izni
  function requestNotificationPermission() {
    if (!("Notification" in window)) {
      console.log("Notification API desteklenmiyor.");
      return;
    }
    if (Notification.permission !== "granted") {
      Notification.requestPermission()
        .then(permission => {
          console.log("Bildirim izni durumu:", permission);
        })
        .catch(err => {
          console.error("Bildirim izni alınamadı:", err);
        });
    } else {
      console.log("Bildirim izni zaten verilmiş:", Notification.permission);
    }
  }

  // Tarayıcı bildirimi + ses
  function sendNotification(message) {
    if (!("Notification" in window)) {
      console.log("Notification API desteklenmiyor, mesaj:", message);
      return;
    }
    if (Notification.permission === "granted") {
      try {
        const notificationSound = new Audio(
          "https://www.soundjay.com/button/beep-07.wav"
        );
        notificationSound.play().catch(() => {});
      } catch (e) {
        console.warn("Ses çalınamadı:", e);
      }
      new Notification(message);
      console.log("Bildirim gönderildi:", message);
    } else {
      console.log("Bildirim izni verilmedi. Mesaj:", message);
    }
  }

  // Sayfa yüklendiğinde
  window.addEventListener("load", () => {
    requestNotificationPermission();

    // Google Form modal kontrolü
    const openFormBtn = document.getElementById("openFormBtn");
    const formModal   = document.getElementById("formModal");
    const closeFormBtn = document.getElementById("closeFormBtn");

    if (openFormBtn && formModal) {
      openFormBtn.addEventListener("click", () => {
        formModal.classList.remove("form-modal--hidden");
      });
    }

    if (closeFormBtn && formModal) {
      closeFormBtn.addEventListener("click", () => {
        formModal.classList.add("form-modal--hidden");
      });
    }

    if (formModal) {
      const backdrop = formModal.querySelector(".form-modal__backdrop");
      if (backdrop) {
        backdrop.addEventListener("click", () => {
          formModal.classList.add("form-modal--hidden");
        });
      }
    }

    // İlk yükleme
    refreshQueue();
    refreshWarning();
    syncTimersFromState(); // localStorage'daki sayaçları tabloya yansıt

    // Her 5 saniyede bir sıra + uyarı metni güncelle
    setInterval(() => {
      refreshQueue();
      refreshWarning();
    }, 5000);

    // 3.8 saniye sonra canvas'ları fade-out ile kaldır
    setTimeout(() => {
      document
        .querySelectorAll('#canvas-shapes, #canvas-stars')
        .forEach(canvas => {
          canvas.classList.add('fade-out');
          setTimeout(() => canvas.remove(), 1000);
        });
    }, 3800);
  });
  </script>
</body>
</html>
